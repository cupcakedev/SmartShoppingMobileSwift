var SmartShopping;(()=>{"use strict";var e={20:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.logger=void 0;const s={print(){},send(){}};t.logger=s,s.print=(e,t)=>console.log(e,t)},242:(e,t,s)=>{s.r(t),s.d(t,{createNanoEvents:()=>o});let o=()=>({events:{},emit(e,...t){(this.events[e]||[]).forEach((e=>e(...t)))},on(e,t){return(this.events[e]=this.events[e]||[]).push(t),()=>this.events[e]=(this.events[e]||[]).filter((e=>e!==t))}})}},t={};function s(o){var r=t[o];if(void 0!==r)return r.exports;var c=t[o]={exports:{}};return e[o](c,c.exports,s),c.exports}s.d=(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};(()=>{var e=o;Object.defineProperty(e,"__esModule",{value:!0}),e.Engine=void 0;const t=s(242),r=s(20),c={isMobile:!0,onMessage(e){if(this.isMobile){const t=t=>{console.log(t),e(t.detail,null,(e=>this.sendMessage(e)))};window.addEventListener("SmartShoppingWebViewMessage",t,!1)}else chrome.runtime.onMessage.addListener(e)},sendMessage(e,t){this.isMobile?(console.log("SEND MESSAGE",e),window.webkit.messageHandlers.SmartshoppingMessageBridge.postMessage(JSON.stringify(e)),t(null)):chrome.runtime.sendMessage(e,t)}},i=e=>{if("string"==typeof e)return document.querySelector(e);let t=null;for(const s of e.shadowRoots){const e=(t||document).querySelector(s);if(!e){t=null;break}t=e.shadowRoot}return t&&t.querySelector(e.target)},n=e=>null!==e&&!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length),a=e=>{let t;switch(e.type){case"element_visible":t=n(i(e.value)),r.logger.print(`element visible: ${t}`,{command:"parse",code:"doesnt matter"});break;case"or":t=e.operands.map((e=>a(e))).includes(!0);break;case"and":t=!e.operands.map((e=>a(e))).includes(!1);break;case"not":t=!a(e.operands[0])}return t};e.Engine=class{constructor(){this.emitter=(0,t.createNanoEvents)(),this._checkoutState={total:null},this._finalCost={},this._progress="IDLE",this.context={code:"",codeIsValid:!1,value:null,return:0,criticalError:!1,anchor:null,anchorCode:null,anchorStage:null},this._config={version:0,taskId:"",shopId:"",shopName:"",shopUrl:"",checkoutUrl:"",selectorsToCheck:[],extendedLogs:!1,extendedReports:!1,inspect:[],detect:[],apply:[],applyBest:[]},this._observers=[],this._promocodes=[],this._currentCode="",this._detectState={userCode:"",isValid:!1},this._bestCode="",this._checkout=!1;c.onMessage(((e,t,s)=>(((e,t,s)=>{if(console.log("handleCheck"),console.log(e),"smartshopping_check"!==e.type)return;if(null===e.defaultSelectors)return;const o=Object.keys(e.defaultSelectors).find((t=>!e.defaultSelectors[t].map((e=>i(e))).includes(null)));o&&r.logger.print(`e-commerce platform - ${o}`,{command:"handleCheck",code:""}),s(o||null)})(e,0,s),!0))),c.onMessage((async e=>{if("smartshopping_init"===e.type&&JSON.parse(e.config)&&(this.config=JSON.parse(e.config),this.promocodes=e.promocodes,e.persistedState&&(this.context=e.persistedState.context,this.checkoutState=e.persistedState.checkoutState,this.finalCost=e.persistedState.finalCost),this.checkout=e.checkout,e.checkout&&!e.persistedState&&r.logger.send({type:"checkout",shop:this.config.shopId}),e.persistedState))if("complete"===document.readyState)switch(e.persistedState.context.anchorStage){case"inspect":this.fullCycle();break;case"detect":await this.detect();break;case"apply":await this.apply(),this.applyBest();break;case"applyBest":this.applyBest()}else{let t;switch(e.persistedState.context.anchorStage){case"inspect":t=()=>this.fullCycle();break;case"detect":t=async()=>{await this.detect()};break;case"apply":t=async()=>{await this.apply(),this.applyBest()};break;case"applyBest":t=()=>this.applyBest()}const s=()=>{t(),document.removeEventListener("load",s)};document.addEventListener("load",s)}}))}get checkoutState(){return Object.assign({},this._checkoutState)}set checkoutState(e){this._checkoutState=Object.assign({},e),this.emitter.emit("checkoutState",Object.assign({},e),this.state())}get finalCost(){return Object.assign({},this._finalCost)}set finalCost(e){this._finalCost=Object.assign({},e),this.emitter.emit("finalCost",Object.assign({},e),this.state())}get progress(){return this._progress}set progress(e){this._progress=e,this.emitter.emit("progress",e,this.state())}clearObservers(){this._observers.forEach((e=>{e.disconnect()})),setTimeout((()=>{this._observers=[]}),0)}addObserver(e){this._observers.push(e)}get config(){return Object.assign({},this._config)}set config(e){this._config=JSON.parse(JSON.stringify(e)),this.emitter.emit("config",JSON.parse(JSON.stringify(e)),this.state())}get promocodes(){return[...this._promocodes]}set promocodes(e){this._promocodes=[...e],this.emitter.emit("promocodes",[...e],this.state())}get currentCode(){return this._currentCode}set currentCode(e){this._currentCode=e,this.emitter.emit("currentCode",e,this.state())}get detectState(){return Object.assign({},this._detectState)}set detectState(e){this._detectState=e,this.emitter.emit("detectState",e,this.state())}get bestCode(){return this._bestCode}set bestCode(e){this._bestCode=e,this.emitter.emit("bestCode",e,this.state())}get checkout(){return this._checkout}set checkout(e){this._checkout=e,this.emitter.emit("checkout",e,this.state())}state(){return{checkoutState:this.checkoutState,finalCost:this.finalCost,progress:this.progress,config:this.config,promocodes:this.promocodes,detectState:this.detectState,bestCode:this.bestCode,currentCode:this.currentCode,checkout:this.checkout}}subscribe({checkoutState:e=(()=>{}),finalCost:t=(()=>{}),progress:s=(()=>{}),config:o=(()=>{}),promocodes:r=(()=>{}),detectState:c=(()=>{}),bestCode:i=(()=>{}),currentCode:n=(()=>{}),checkout:a=(()=>{})}){return{checkoutState:this.emitter.on("checkoutState",e),finalCost:this.emitter.on("finalCost",t),progress:this.emitter.on("progress",s),config:this.emitter.on("config",o),promocodes:this.emitter.on("promocodes",r),detectState:this.emitter.on("detectState",c),bestCode:this.emitter.on("bestCode",i),currentCode:this.emitter.on("currentCode",n),checkout:this.emitter.on("checkout",a)}}unsubscribe(e){for(const t of Object.keys(e))e[t]()}async commandIf(e,t,s,o){let c=Object.assign({},o);const i={command:"if",code:c.code};try{const o=a(e);r.logger.print(`condition parsed, result: ${o}`,i),c.anchor?(c=await this.execCommands(t,c),c.anchor&&(c=await this.execCommands(s,c))):o?(r.logger.print("executing DO branch",i),c=await this.execCommands(t,c)):(r.logger.print("executing ELSE branch",i),c=await this.execCommands(s,c))}catch(e){c.return++,r.logger.print("CRITICAL: invalid selector",i),r.logger.send({type:"error",shop:this.config.shopId,message:"invalid selector"})}return c}async iterationCodes(e,t){let s=Object.assign({},t);for(const t of this.promocodes)r.logger.print(`executing for code ${t}`,{code:"",command:"iteration_codes"}),this.currentCode=t,s=await this.execCommands(e,Object.assign(Object.assign({},s),{code:t})),s.return=0;return s}async commandWhile(e,t,s){let o=Object.assign({},s);const c={command:"while",code:o.code};for(;;)try{if(o.criticalError||this.context.criticalError)return o.criticalError=!0,o;const s=a(e);if(r.logger.print(`condition parsed, result: ${s}`,c),o.anchor){if(o=await this.execCommands(t,o),o.anchor){r.logger.print("exit while loop",c);break}}else{if(!s){r.logger.print("exit while loop",c);break}r.logger.print("while loop iteration",c),o=await this.execCommands(t,o)}}catch(e){o.return++,r.logger.print("CRITICAL: invalid selector",c),r.logger.send({type:"error",shop:this.config.shopId,message:"invalid selector"}),r.logger.print("exit while loop",c);break}return o}async Anchor(e,t,s){const o=Object.assign({},s),i={command:"anchor",code:o.code};switch(t){case"before":null===o.anchor&&(await new Promise((t=>{c.sendMessage({type:"smartshopping_persist",persistedState:{context:Object.assign(Object.assign({},o),{anchor:e,anchorCode:o.code,anchorStage:{INSPECT:"inspect",DETECT:"detect",APPLY:"apply","APPLY-BEST":"applyBest"}[this.progress]}),finalCost:this.finalCost,checkoutState:this.checkoutState}},(()=>{t()}))})),r.logger.print(`anchor "${e}"`,i));break;case"after":null===o.anchor&&await new Promise((e=>setTimeout(e,1e6))),o.anchor===e&&o.anchorCode===o.code&&(o.anchor=null,o.anchorCode=null,o.anchorStage=null,r.logger.print(`anchor "${e}" passed for code "${o.code}"`,i))}return o}async commandWait(e,t,s=null){const o=Object.assign({},t),c={command:"wait",code:o.code};if(o.anchor)return o;if(null===s)return r.logger.print(`no response needed, waiting ${e} ms`,c),await new Promise((t=>setTimeout(t,e))),o;r.logger.print("waiting for changes...",c);try{await new Promise(((t,a)=>{let l=!1;s.forEach((s=>{let d,h;switch(s.type){case"added":if(h={childList:!0,subtree:!0},"string"==typeof s.selector)d=new MutationObserver((()=>{const e=i(s.selector);n(e)&&(r.logger.print(`element matching ${s.selector} selector was added`,c),l=!0,d.disconnect(),t(!0))})),d.observe(document,h),this.addObserver(d),setTimeout((()=>{l||(d.disconnect(),a(new Error))}),e);else{const o=[];d=new MutationObserver((()=>{const e=i(s.selector);n(e)&&(r.logger.print(`element matching ${s.selector} selector was added`,c),l=!0,o.forEach((e=>e.disconnect())),t(!0))})),d.observe(document,h),this.addObserver(d),o.push(d);let g=null;const{shadowRoots:p}=s.selector;for(const e of p){const a=(g||document).querySelector(e);if(!a)break;g=a.shadowRoot,d=new MutationObserver((()=>{const e=i(s.selector);n(e)&&(r.logger.print(`element matching ${s.selector} selector was added`,c),l=!0,o.forEach((e=>e.disconnect())),t(!0))})),d.observe(g,h),this.addObserver(d),o.push(d)}setTimeout((()=>{l||(o.forEach((e=>e.disconnect())),a(new Error))}),e)}break;case"removed":if(h={childList:!0,subtree:!0},"string"==typeof s.selector)d=new MutationObserver((()=>{const e=i(s.selector);n(e)||(r.logger.print(`element matching ${s.selector} selector was removed`,c),l=!0,d.disconnect(),t(!0))})),d.observe(document,h),this.addObserver(d),setTimeout((()=>{l||(d.disconnect(),a(new Error))}),e);else{const o=[];d=new MutationObserver((()=>{const e=i(s.selector);n(e)||(r.logger.print(`element matching ${s.selector} selector was removed`,c),l=!0,o.forEach((e=>e.disconnect())),t(!0))})),d.observe(document,h),this.addObserver(d),o.push(d);let g=null;s.selector.shadowRoots.forEach((e=>{g=(g||document).querySelector(e).shadowRoot,d=new MutationObserver((()=>{const e=i(s.selector);n(e)||(r.logger.print(`element matching ${s.selector} selector was removed`,c),l=!0,o.forEach((e=>e.disconnect())),t(!0))})),d.observe(g,h),this.addObserver(d),o.push(d)})),setTimeout((()=>{l||(o.forEach((e=>e.disconnect())),a(new Error))}),e)}break;case"changed":h={characterData:!0,attributes:!0,childList:!0,subtree:!0},d=new MutationObserver((e=>{e.forEach((()=>{r.logger.print(`element matching ${s.selector} selector was changed`,c),l=!0,d.disconnect(),t(!0)}))}));const g=i(s.selector);null===g?(r.logger.print("CRITICAL: invalid selector",c),r.logger.send({type:"error",shop:this.config.shopId,message:"invalid selector"}),o.criticalError=!0,a(new Error)):(d.observe(g,h),setTimeout((()=>{l||(d.disconnect(),a(new Error))}),e))}}))}))}catch(t){r.logger.print(`${e} ms timeout expired, fail`,c),o.return++}return o}commandInsert(e,t,s){const o=Object.assign({},t),c=void 0===s?o.code:s,n={command:"insert",code:o.code};if(o.anchor)return o;const a=i(e);return a?(a.focus(),a.value=c,a.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})),a.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!0})),r.logger.print(`code ${c} injected in element matching ${e} selector`,n),o):(r.logger.print("CRITICAL: invalid selector",n),r.logger.send({type:"error",shop:this.config.shopId,message:"invalid selector"}),o.criticalError=!0,o)}commandApply(e,t){const s=Object.assign({},t),o={command:"apply",code:s.code};if(s.anchor)return s;const c=i(e.selector);return c?("click"===e.type&&["BUTTON","INPUT","A"].includes(c.nodeName)?c.click():c.dispatchEvent(new Event(e.type,{bubbles:!0,cancelable:!1,composed:!0})),r.logger.print(`action "${e.type}" performed on ${e.selector} element`,o),s):(r.logger.print("CRITICAL: invalid selector",o),r.logger.send({type:"error",shop:this.config.shopId,message:"invalid selector"}),s.criticalError=!0,s)}async commandInteract(e,t,s,o){const c=Object.assign({},o),a={command:"interact",code:c.code};if(c.anchor)return c;const l=i(e.selector);if(r.logger.print(`ACTION TARGET: ${l}`,a),!l)return r.logger.print("CRITICAL: invalid selector",a),r.logger.send({type:"error",shop:this.config.shopId,message:"invalid selector"}),c.criticalError=!0,c;r.logger.print(`trying to ${e.type} ${e.selector} element and wait...`,a);try{await new Promise(((o,d)=>{let h=!1;t.forEach((e=>{let t,l;switch(e.type){case"added":if(l={childList:!0,subtree:!0},"string"==typeof e.selector)t=new MutationObserver((()=>{const s=i(e.selector);n(s)&&(r.logger.print(`element matching ${e.selector} selector was added`,a),h=!0,t.disconnect(),o(!0))})),t.observe(document,l),this.addObserver(t),setTimeout((()=>{h||(t.disconnect(),d(new Error))}),s);else{const c=[];t=new MutationObserver((()=>{const t=i(e.selector);n(t)&&(r.logger.print(`element matching ${e.selector} selector was added`,a),h=!0,c.forEach((e=>e.disconnect())),o(!0))})),t.observe(document,l),this.addObserver(t),c.push(t);let g=null;const{shadowRoots:p}=e.selector;for(const s of p){const d=(g||document).querySelector(s);if(!d)break;g=d.shadowRoot,t=new MutationObserver((()=>{const t=i(e.selector);n(t)&&(r.logger.print(`element matching ${e.selector} selector was added`,a),h=!0,c.forEach((e=>e.disconnect())),o(!0))})),t.observe(g,l),this.addObserver(t),c.push(t)}setTimeout((()=>{h||(c.forEach((e=>e.disconnect())),d(new Error))}),s)}break;case"removed":if(l={childList:!0,subtree:!0},"string"==typeof e.selector)t=new MutationObserver((()=>{const s=i(e.selector);n(s)||(r.logger.print(`element matching ${e.selector} selector was removed`,a),h=!0,t.disconnect(),o(!0))})),t.observe(document,l),this.addObserver(t),setTimeout((()=>{h||(t.disconnect(),d(new Error))}),s);else{const c=[];t=new MutationObserver((()=>{const t=i(e.selector);n(t)||(r.logger.print(`element matching ${e.selector} selector was removed`,a),h=!0,c.forEach((e=>e.disconnect())),o(!0))})),t.observe(document,l),this.addObserver(t),c.push(t);let g=null;e.selector.shadowRoots.forEach((s=>{g=(g||document).querySelector(s).shadowRoot,t=new MutationObserver((()=>{const t=i(e.selector);n(t)||(r.logger.print(`element matching ${e.selector} selector was removed`,a),h=!0,c.forEach((e=>e.disconnect())),o(!0))})),t.observe(g,l),this.addObserver(t),c.push(t)})),setTimeout((()=>{h||(c.forEach((e=>e.disconnect())),d(new Error))}),s)}break;case"changed":l={characterData:!0,attributes:!0,childList:!0,subtree:!0},t=new MutationObserver((s=>{s.forEach((()=>{r.logger.print(`element matching ${e.selector} selector was changed`,a),h=!0,t.disconnect(),o(!0)}))}));const g=i(e.selector);g?(t.observe(g,l),this.addObserver(t),setTimeout((()=>{h||(t.disconnect(),d(new Error))}),s)):(r.logger.print("CRITICAL: invalid selector",a),r.logger.send({type:"error",shop:this.config.shopId,message:"invalid selector"}),c.criticalError=!0,d(new Error))}})),"click"===e.type&&["BUTTON","INPUT","A"].includes(l.nodeName)?l.click():l.dispatchEvent(new Event(e.type,{bubbles:!0,cancelable:!1,composed:!0})),r.logger.print(`action "${e.type}" performed on ${e.selector} element`,a)}))}catch(e){r.logger.print(`${s} ms timeout expired, fail`,a),c.return++}return this.clearObservers(),c}commandExtract(e,t,s,o,c,n){const a=Object.assign({},n),l={command:"extract",code:a.code};if(a.anchor)return a;if("undefinedCode"===o)return a.value="UNDEFINED_CODE",a.codeIsValid=null!=c&&c,r.logger.print('value "UNDEFINED_CODE" was extracted',l),a;const d=i(e);if(!d)return r.logger.print("CRITICAL: invalid selector",l),r.logger.send({type:"error",shop:this.config.shopId,message:"invalid selector"}),a.criticalError=!0,a;let h;if(h=(null==t?void 0:t.startsWith("data-"))?d.dataset[t.slice(5).split("-").map(((e,t)=>0===t?e:e.charAt(0).toUpperCase()+e.slice(1))).join("")]:t?d[t]:d.textContent,s)switch(s.position){case"before":h=h.slice(0,h.indexOf(s.rightEdge));break;case"after":h=h.slice(h.lastIndexOf(s.leftEdge)+s.leftEdge.length);break;case"between":h=h.slice(h.indexOf(s.leftEdge)+s.leftEdge.length,h.indexOf(s.rightEdge,h.indexOf(s.leftEdge)+s.leftEdge.length))}switch(o){case"number":h=h.replace(/[^\d.,]/gi,""),h=h.replace(/[,]/gi,"."),h=Array.from(h).map(((e,t)=>"."===e&&h.length-t>3?"":e)).join("");break;case"decimalNumberWithoutDot":h=h.replace(/[^\d]/gi,""),h=Array.from(h).map(((e,t)=>h.length-t==2?".".concat(e):e)).join("");break;case"code":h=h.toUpperCase(),h=h.replace(/\s/gi,"")}return a.value=h,"code"===o&&null!==c&&(a.codeIsValid=c),r.logger.print(`value "${a.value}" was extracted from ${e} elements`,l),a}commandStore(e,t){const s=Object.assign({},t),o={command:"store",code:s.code};if(s.anchor)return s;if(!s.value)return r.logger.print("no value to store",o),s.return++,s;switch(e){case"code":s.code=s.value,r.logger.print(`current code is ${s.value}`,o);break;case"total":this.checkoutState=Object.assign(Object.assign({},this.checkoutState),{total:parseFloat(s.value)}),r.logger.print(`stored ${parseFloat(s.value)} in TOTAL`,o);break;case"final":this.finalCost=Object.assign(Object.assign({},this.finalCost),{[s.code]:parseFloat(s.value)}),r.logger.print(`stored ${parseFloat(s.value)} in FINAL for code ${s.code}`,o)}return s}async execCommands(e,t){let s=Object.assign({},t);const o={command:"EXEC",code:""};for(const t of e){if(s.return)return s.return--,r.logger.print("RETURN",o),s;if(s.criticalError||this.context.criticalError)return s.criticalError=!0,s;switch(t.type){case"anchor":s=await this.Anchor(t.anchor,t.place,s);break;case"command_if":s=await this.commandIf(t.condition,t.do,t.else,s);break;case"iteration_codes":s=await this.iterationCodes(t.do,s);break;case"command_while":s=await this.commandWhile(t.condition,t.do,s);break;case"command_wait":s=void 0!==t.response?await this.commandWait(t.timeout,s,t.response):await this.commandWait(t.timeout,s);break;case"command_insert":s=void 0!==t.value?this.commandInsert(t.selector,s,t.value):this.commandInsert(t.selector,s);break;case"command_apply":s=this.commandApply(t.action,s);break;case"command_interact":s=await this.commandInteract(t.action,t.response,t.timeout,s);break;case"command_store":s=this.commandStore(t.target,s);break;case"command_extract":s=this.commandExtract(t.selector,t.target,t.cut,t.format,t.codeIsValid,s);break;case"command_return":s.return+=t.level}}return s}findBestCode(e){const t=Math.min(...Object.values(e));let s="";if(t!==this.checkoutState.total){for(const o of Object.keys(e))e[o]===t&&(s=o);t>this.checkoutState.total&&this.config.extendedReports&&r.logger.send({type:"report",shop:this.config.shopId,url:window.location.href,total:this.checkoutState.total.toFixed(2),discount:(this.checkoutState.total-this.finalCost[s]).toFixed(2),codes:JSON.stringify(e),layoutPage:""}),this.bestCode=s}}async checkSelectors(){const e={command:"SELECTORS_CHECK",code:""};this.config.selectorsToCheck.forEach((t=>{null===i(t)&&(r.logger.print(`invalid selector: "${t}"`,e),this.context.criticalError=!0)}))}async inspect(){let e=Object.assign({},this.context);if(this.progress="INSPECT",r.logger.print("Inspecting...",{command:"STEP_INSPECT",code:""}),e=await this.execCommands(this.config.inspect,e),this.context=Object.assign({},e),await this.checkSelectors(),e=Object.assign({},this.context),e.criticalError)return r.logger.send({type:"error",shop:this.config.shopId,message:"invalid selector"}),void(this.progress="ERROR");e.anchor||r.logger.send({type:"show",shop:this.config.shopId,total:this.checkoutState.total.toFixed(2)}),this.progress="INSPECT_END"}async detect(){let e=Object.assign({},this.context);if(e.criticalError)return this.context=Object.assign({},e),void(this.progress="ERROR");for(this.progress="DETECT",r.logger.print("Detecting...",{command:"STEP_DETECT",code:""});;){if(e=await this.execCommands(this.config.detect,e),e.criticalError||this.context.criticalError){this.context=Object.assign({},e);break}e.anchor||""===e.code||e.code===this.detectState.userCode||(r.logger.send({type:"detect",shop:this.config.shopId,code:e.code,valid:e.codeIsValid}),this.detectState={userCode:e.code,isValid:e.codeIsValid},r.logger.print("Detected user code",{command:"",code:e.code})),this.context=Object.assign({},e)}}async apply(){let e=Object.assign({},this.context);if(e.criticalError)return this.context=Object.assign({},e),void(this.progress="ERROR");e.anchor||r.logger.send({type:"start",shop:this.config.shopId}),this.progress="APPLY",r.logger.print("Applying codes...",{command:"STEP_APPLY",code:""}),e=await this.execCommands(this.config.apply,e),this.context=Object.assign({},e),this.progress="APPLY_END"}async applyBest(){const e=Object.assign({},this.context),t={command:"STEP_APPLY_BEST",code:""};e.criticalError?this.progress="ERROR":(this.progress="APPLY-BEST",this.findBestCode(this.finalCost),""!==this.bestCode?(r.logger.print(`Applying best code... [${this.bestCode}]`,t),await this.execCommands(this.config.applyBest,Object.assign(Object.assign({},e),{code:this.bestCode,value:null,return:0,criticalError:!1})),r.logger.send({type:"success",shop:this.config.shopId,code:this.config.extendedLogs?this.bestCode:"",total:this.checkoutState.total.toFixed(2),discount:(this.checkoutState.total-this.finalCost[this.bestCode]).toFixed(2)})):r.logger.print("All the coupons failed :[",t),c.sendMessage({type:"smartshopping_clear"}),this.progress="APPLY-BEST_END")}notifyAboutShowModal(){r.logger.send({type:"show_slider",shop:this.config.shopId})}notifyAboutCloseModal(){r.logger.send({type:"close_slider",shop:this.config.shopId})}abort(){this.context.criticalError=!0,this.progress="CANCEL",r.logger.send({type:"abort",shop:this.config.shopId})}async fullCycle(){await this.inspect(),await this.apply(),await this.applyBest()}}})(),SmartShopping=o})();